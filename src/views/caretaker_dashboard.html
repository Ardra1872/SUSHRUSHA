  <!DOCTYPE html>

  <html class="light" lang="en"><head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>Sushrusha | Family Caretaker Dashboard</title>
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght@100..700,0..1&amp;display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
  <script id="tailwind-config">
          tailwind.config = {
              darkMode: "class",
              theme: {
                  extend: {
                      colors: {
                          "primary": "#137fec",
                          "background-light": "#f6f7f8",
                          "background-dark": "#101922",
                      },
                      fontFamily: {
                          "display": ["Inter"]
                      },
                      borderRadius: {"DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "full": "9999px"},
                  },
              },
          }
      </script>
  <style>
          body { font-family: 'Inter', sans-serif; }
          .material-symbols-outlined {
              font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
          }
      </style>
  </head>
  <body class="bg-background-light dark:bg-background-dark text-[#0d141b] dark:text-slate-100 font-display min-h-screen">
  <div class="flex h-full min-h-screen w-full">
  <!-- Side Navigation -->
  <aside class="w-64 border-r border-[#cfdbe7] dark:border-slate-800 bg-white dark:bg-slate-900 hidden lg:flex flex-col sticky top-0 h-screen">
  <div class="flex flex-col h-full justify-between p-4">
  <div class="flex flex-col gap-8">
  <!-- Brand -->
  <div class="flex gap-3 items-center px-2">
  <div class="bg-primary size-10 rounded-lg flex items-center justify-center text-white">
  <span class="material-symbols-outlined">medical_services</span>
  </div>
  <div class="flex flex-col">
  <h1 class="text-[#0d141b] dark:text-white text-base font-bold leading-none">Sushrusha</h1>
  <p class="text-[#4c739a] text-xs font-normal">Family Caretaker</p>
  </div>
  </div>
  <!-- Nav Links -->
  <nav class="flex flex-col gap-1" id="sidebar">
    <a data-section="dashboard" class="flex items-center gap-3 px-3 py-2 rounded-lg bg-primary/10 text-primary" href="#">
      <span class="material-symbols-outlined">dashboard</span>
      <p class="text-sm font-semibold">Dashboard</p>
    </a>

    <a data-section="history" class="flex items-center gap-3 px-3 py-2 text-[#4c739a] hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg transition-colors" href="#">
      <span class="material-symbols-outlined">history</span>
      <p class="text-sm font-medium">Medicine History</p>
    </a>

    <a data-section="profile" class="flex items-center gap-3 px-3 py-2 text-[#4c739a] hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg transition-colors" href="#">
      <span class="material-symbols-outlined">person</span>
      <p class="text-sm font-medium">Patient Profile</p>
    </a>

    <a data-section="emergency" class="flex items-center gap-3 px-3 py-2 text-[#4c739a] hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg transition-colors" href="#">
      <span class="material-symbols-outlined">call</span>
      <p class="text-sm font-medium">Emergency Contacts</p>
    </a>

    <a data-section="reports" class="flex items-center gap-3 px-3 py-2 text-[#4c739a] hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg transition-colors" href="#">
      <span class="material-symbols-outlined">description</span>
      <p class="text-sm font-medium">Reports</p>
    </a>
  </nav>

  </div>
  <div class="flex flex-col gap-4">
  <button class="flex items-center justify-center gap-2 rounded-lg h-10 px-4 bg-primary text-white text-sm font-bold w-full">
  <span class="material-symbols-outlined text-sm">add</span>
  <span>Add Note</span>
  </button>
  <div class="pt-4 border-t border-[#cfdbe7] dark:border-slate-800 flex items-center gap-3 px-2">
  <div id="caretaker-photo" class="bg-primary text-white flex items-center justify-center aspect-square rounded-full size-8">
      <span class="material-symbols-outlined text-xl">medical_services</span>
  </div>

  <div class="flex-1 overflow-hidden">
      <p id="caretaker-name" class="text-[#0d141b] dark:text-white text-xs font-bold truncate">Loading...</p>
      <p id="caretaker-role" class="text-[#4c739a] text-[10px] truncate">Loading...</p>
  </div>

  <!-- <span class="material-symbols-outlined text-[#4c739a] text-sm">settings</span> -->
  </div>
  </div>
  </div>
  </aside>
  <!-- Main Content Area -->
  <main class="flex-1 flex flex-col overflow-y-auto max-w-full">
  <!-- Top Nav -->
  <header class="flex items-center justify-between border-b border-[#cfdbe7] dark:border-slate-800 bg-white dark:bg-slate-900 px-6 py-3 sticky top-0 z-10">
  <div class="flex items-center gap-4">
  <h2 class="text-[#0d141b] dark:text-white text-lg font-bold">Caretaker Dashboard</h2>
  </div>
  <div class="flex items-center gap-4">
  <label class="hidden md:flex items-center bg-background-light dark:bg-slate-800 rounded-lg px-3 h-10 w-64">
  <span class="material-symbols-outlined text-[#4c739a] mr-2">search</span>
  <input class="bg-transparent border-none focus:ring-0 text-sm w-full placeholder:text-[#4c739a]" placeholder="Search medicine or notes..." type="text"/>
  </label>
  <button class="relative p-2 text-[#4c739a] hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg transition-colors">
  <span class="material-symbols-outlined">notifications</span>
  <span class="absolute top-2 right-2 size-2 bg-red-500 rounded-full border-2 border-white dark:border-slate-900"></span>
  </button>
  <!-- <div class="h-8 w-[1px] bg-[#cfdbe7] dark:bg-slate-800 mx-1"></div>
  <div class="flex items-center gap-2">
  <p class="text-xs font-medium text-[#4c739a] hidden sm:block">Syncing...</p>
  <span class="material-symbols-outlined text-primary text-sm animate-spin">sync</span>
  </div>
  </div> -->
  </header>
  <div class="p-6 space-y-6 max-w-6xl mx-auto w-full">
  <!-- Urgent Alert -->
   
  <div class="p-4 @container">
  <div class="flex flex-1 flex-col items-start justify-between gap-4 rounded-xl border border-red-200 bg-red-50 dark:bg-red-950/20 dark:border-red-900/30 p-5 @[480px]:flex-row @[480px]:items-center">
  <div class="flex items-center gap-4">
  <div class="bg-red-500 text-white p-2 rounded-full flex items-center justify-center">
  <span class="material-symbols-outlined">priority_high</span>
  </div>
  <div class="flex flex-col gap-1">
  <p class="text-red-700 dark:text-red-400 text-base font-bold leading-tight">Missed Dose Alert</p>
  <p class="text-red-600 dark:text-red-300 text-base font-normal leading-normal">Urgent: Mom missed her 8:00 AM Metformin (500mg) dose.</p>
  </div>
  </div>
  <div class="flex gap-2 w-full @[480px]:w-auto">
  <button class="flex-1 @[480px]:flex-none min-w-[120px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 bg-red-600 text-white text-sm font-bold shadow-sm active:scale-95 transition-all">
  <span>Call Mom</span>
  </button>
  <button class="flex-1 @[480px]:flex-none min-w-[80px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 border border-red-200 bg-white text-red-600 text-sm font-bold hover:bg-red-50 transition-all">
  <span>Dismiss</span>
  </button>
  </div>
  </div>
  </div>
  <!-- Patient Profile Header -->
  <!-- Patient Profile Header -->
<div class="bg-white dark:bg-slate-900 rounded-xl border border-[#cfdbe7] dark:border-slate-800 p-6">
  <div class="flex flex-col md:flex-row md:items-center justify-between gap-6">
    <div class="flex gap-6 items-center">
      <div class="relative">
        <!-- Patient photo -->
        <div id="patient-photo" class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-24 border-4 border-primary/20" data-alt="Patient profile"></div>
        <div class="absolute bottom-0 right-0 size-7 bg-green-500 rounded-full border-4 border-white dark:border-slate-900"></div>
      </div>
      <div class="flex flex-col justify-center">
        <div class="flex items-center gap-2">
          <h2 id="patient-name" class="text-[#0d141b] dark:text-white text-2xl font-bold tracking-tight">Loading...</h2>
          <span id="patient-care-status" class="px-2 py-0.5 bg-primary/10 text-primary text-[10px] font-bold rounded-full uppercase">Loading...</span>
        </div>
        <div class="flex flex-wrap gap-x-6 gap-y-1 mt-2">
          <p class="text-[#4c739a] text-sm flex items-center gap-1">
            <span class="material-symbols-outlined text-sm">monitoring</span>
            Adherence Score: <span id="patient-adherence" class="font-bold text-green-600">--</span>
          </p>
          <p class="text-[#4c739a] text-sm flex items-center gap-1">
            <span class="material-symbols-outlined text-sm">schedule</span>
            Last synced: <span id="patient-synced" class="font-medium">--</span>
          </p>
        </div>
      </div>
    </div>
    <div class="flex gap-3">
      <button   id="view-profile-btn" class="flex-1 md:flex-none min-w-[120px] rounded-lg h-10 px-4 border border-[#cfdbe7] dark:border-slate-700 text-[#0d141b] dark:text-white text-sm font-bold hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors">
        View Profile
      </button>
     <button id="full-history-btn" class="flex-1 md:flex-none min-w-[120px] rounded-lg h-10 px-4 bg-primary text-white text-sm font-bold shadow-lg shadow-primary/20 active:scale-95 transition-all">
  Full History
</button>

    </div>
  </div>
</div>

  <!-- Stats Grid -->
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
  <div class="flex flex-col gap-2 rounded-xl p-6 border border-[#cfdbe7] dark:border-slate-800 bg-white dark:bg-slate-900 shadow-sm">
  <div class="flex items-center justify-between">
  <p class="text-[#4c739a] dark:text-slate-400 text-sm font-medium">Doses Taken Today</p>
  <div class="p-2 bg-green-50 dark:bg-green-950/30 rounded-lg">
  <span class="material-symbols-outlined text-green-600 text-xl">check_circle</span>
  </div>
  </div>
  <p class="text-[#0d141b] dark:text-white tracking-tight text-3xl font-bold">3 / 5</p>
  <p class="text-green-600 text-sm font-semibold flex items-center gap-1">
  <span class="material-symbols-outlined text-sm">trending_up</span>
                              +12% from yesterday
                          </p>
  </div>
  <div class="flex flex-col gap-2 rounded-xl p-6 border border-[#cfdbe7] dark:border-slate-800 bg-white dark:bg-slate-900 shadow-sm">
  <div class="flex items-center justify-between">
  <p class="text-[#4c739a] dark:text-slate-400 text-sm font-medium">Doses Missed</p>
  <div class="p-2 bg-red-50 dark:bg-red-950/30 rounded-lg">
  <span class="material-symbols-outlined text-red-600 text-xl">error</span>
  </div>
  </div>
  <p class="text-[#0d141b] dark:text-white tracking-tight text-3xl font-bold">1</p>
  <p class="text-[#4c739a] text-sm font-medium">Action required</p>
  </div>
  <div class="flex flex-col gap-2 rounded-xl p-6 border border-[#cfdbe7] dark:border-slate-800 bg-white dark:bg-slate-900 shadow-sm">
  <div class="flex items-center justify-between">
  <p class="text-[#4c739a] dark:text-slate-400 text-sm font-medium">Next Upcoming</p>
  <div class="p-2 bg-primary/10 rounded-lg">
  <span class="material-symbols-outlined text-primary text-xl">event_upcoming</span>
  </div>
  </div>
  <p class="text-[#0d141b] dark:text-white tracking-tight text-3xl font-bold">1:00 PM</p>
  <p class="text-primary text-sm font-semibold">In 2 hours</p>
  </div>
  </div>
  <!-- Today's Schedule -->
  <div class="space-y-4">
  <div class="flex items-center justify-between">
  <h3 class="text-xl font-bold text-[#0d141b] dark:text-white">Today's Schedule</h3>
  <div class="flex gap-2">
  <button class="p-2 rounded-lg border border-[#cfdbe7] dark:border-slate-700 bg-white dark:bg-slate-900 hover:bg-slate-50 transition-colors">
  <span class="material-symbols-outlined text-sm">chevron_left</span>
  </button>
  <span class="flex items-center px-3 bg-white dark:bg-slate-800 border border-[#cfdbe7] dark:border-slate-700 rounded-lg text-sm font-bold">Monday, Oct 14</span>
  <button class="p-2 rounded-lg border border-[#cfdbe7] dark:border-slate-700 bg-white dark:bg-slate-900 hover:bg-slate-50 transition-colors">
  <span class="material-symbols-outlined text-sm">chevron_right</span>
  </button>
  </div>
  </div>
  <!-- Timeline Feed -->
  <div class="space-y-3 relative before:absolute before:left-8 before:top-4 before:bottom-4 before:w-0.5 before:bg-slate-200 dark:before:bg-slate-800">
  <!-- Item: Taken -->
  <div class="relative flex gap-6 items-start group">
  <div class="z-10 mt-1 size-16 rounded-full bg-white dark:bg-slate-900 border-2 border-green-500 flex items-center justify-center shrink-0 shadow-sm">
  <span class="material-symbols-outlined text-green-500">pill</span>
  </div>
  <div class="flex-1 bg-white dark:bg-slate-900 border border-[#cfdbe7] dark:border-slate-800 p-4 rounded-xl shadow-sm group-hover:border-primary/30 transition-all">
  <div class="flex justify-between items-start">
  <div>
  <div class="flex items-center gap-2">
  <p class="text-xs font-bold text-green-600 uppercase">Taken at 7:05 AM</p>
  <span class="material-symbols-outlined text-[10px] text-green-600">verified</span>
  </div>
  <h4 class="text-lg font-bold text-[#0d141b] dark:text-white">Atorvastatin</h4>
  <p class="text-[#4c739a] text-sm">20mg • 1 tablet</p>
  </div>
  <span class="px-3 py-1 bg-green-50 dark:bg-green-950/30 text-green-600 text-xs font-bold rounded-full">Completed</span>
  </div>
  <div class="mt-2 flex items-center gap-2 text-xs text-[#4c739a]">
  <span class="material-symbols-outlined text-sm">restaurant</span>
  <span>Take with breakfast</span>
  </div>
  </div>
  </div>
  <!-- Item: Missed -->
  <div class="relative flex gap-6 items-start group">
  <div class="z-10 mt-1 size-16 rounded-full bg-white dark:bg-slate-900 border-2 border-red-500 flex items-center justify-center shrink-0 shadow-sm">
  <span class="material-symbols-outlined text-red-500">medication</span>
  </div>
  <div class="flex-1 bg-white dark:bg-slate-900 border border-red-200 dark:border-red-900/40 p-4 rounded-xl shadow-sm group-hover:border-red-300 transition-all">
  <div class="flex justify-between items-start">
  <div>
  <div class="flex items-center gap-2">
  <p class="text-xs font-bold text-red-600 uppercase">Missed at 8:00 AM</p>
  <span class="material-symbols-outlined text-[10px] text-red-600">warning</span>
  </div>
  <h4 class="text-lg font-bold text-[#0d141b] dark:text-white">Metformin</h4>
  <p class="text-[#4c739a] text-sm">500mg • 1 tablet</p>
  </div>
  <span class="px-3 py-1 bg-red-50 dark:bg-red-950/30 text-red-600 text-xs font-bold rounded-full">Missed</span>
  </div>
  <div class="mt-3 flex gap-2">
  <button class="px-3 py-1.5 bg-primary text-white text-xs font-bold rounded-lg transition-all active:scale-95">Remind Patient</button>
  <button class="px-3 py-1.5 border border-[#cfdbe7] dark:border-slate-700 text-[#4c739a] text-xs font-bold rounded-lg">Mark as Taken</button>
  </div>
  </div>
  </div>
  <!-- Item: Taken -->
  <div class="relative flex gap-6 items-start group">
  <div class="z-10 mt-1 size-16 rounded-full bg-white dark:bg-slate-900 border-2 border-green-500 flex items-center justify-center shrink-0 shadow-sm">
  <span class="material-symbols-outlined text-green-500">vaccines</span>
  </div>
  <div class="flex-1 bg-white dark:bg-slate-900 border border-[#cfdbe7] dark:border-slate-800 p-4 rounded-xl shadow-sm group-hover:border-primary/30 transition-all">
  <div class="flex justify-between items-start">
  <div>
  <div class="flex items-center gap-2">
  <p class="text-xs font-bold text-green-600 uppercase">Taken at 10:15 AM</p>
  </div>
  <h4 class="text-lg font-bold text-[#0d141b] dark:text-white">Vitamin D3</h4>
  <p class="text-[#4c739a] text-sm">2000 IU • 1 capsule</p>
  </div>
  <span class="px-3 py-1 bg-green-50 dark:bg-green-950/30 text-green-600 text-xs font-bold rounded-full">Completed</span>
  </div>
  </div>
  </div>
  <!-- Item: Upcoming -->
  <div class="relative flex gap-6 items-start group">
  <div class="z-10 mt-1 size-16 rounded-full bg-white dark:bg-slate-900 border-2 border-primary flex items-center justify-center shrink-0 shadow-sm">
  <span class="material-symbols-outlined text-primary">fluid</span>
  </div>
  <div class="flex-1 bg-white dark:bg-slate-900 border border-[#cfdbe7] dark:border-slate-800 p-4 rounded-xl shadow-sm group-hover:border-primary/30 transition-all">
  <div class="flex justify-between items-start">
  <div>
  <div class="flex items-center gap-2">
  <p class="text-xs font-bold text-primary uppercase">Upcoming at 1:00 PM</p>
  </div>
  <h4 class="text-lg font-bold text-[#0d141b] dark:text-white">Cough Syrup</h4>
  <p class="text-[#4c739a] text-sm">10ml • Oral solution</p>
  </div>
  <span class="px-3 py-1 bg-primary/10 text-primary text-xs font-bold rounded-full">Due soon</span>
  </div>
  </div>
  </div>
  </div>
  </div>
  </div>
  <!-- Medicine History Section -->
<div id="section-medicine-history" class="hidden p-6 max-w-6xl mx-auto w-full space-y-4">
  <h2 class="text-2xl font-bold text-[#0d141b] dark:text-white">Medicine History</h2>

  <div id="medicine-history-list" class="flex flex-col gap-3">
    <!-- Medicines will be injected here dynamically -->
  </div>
</div>

  </main>
  <!-- Right Sidebar (Caregiver Notes) -->
  <aside class="w-80 border-l border-[#cfdbe7] dark:border-slate-800 bg-white dark:bg-slate-900 hidden xl:flex flex-col p-6 gap-6 overflow-y-auto h-screen sticky top-0">
  <div>
  <h4 class="text-[#0d141b] dark:text-white font-bold mb-4">Patient Calendar</h4>
  <div class="bg-background-light dark:bg-slate-800 rounded-xl p-4">
  <div class="grid grid-cols-7 gap-2 mb-2 text-center">
  <span class="text-[10px] text-[#4c739a] font-bold">M</span>
  <span class="text-[10px] text-[#4c739a] font-bold">T</span>
  <span class="text-[10px] text-[#4c739a] font-bold">W</span>
  <span class="text-[10px] text-[#4c739a] font-bold">T</span>
  <span class="text-[10px] text-[#4c739a] font-bold">F</span>
  <span class="text-[10px] text-[#4c739a] font-bold">S</span>
  <span class="text-[10px] text-[#4c739a] font-bold">S</span>
  </div>
  <div class="grid grid-cols-7 gap-2 text-center">
  <span class="text-xs text-[#4c739a] py-2">12</span>
  <span class="text-xs text-[#4c739a] py-2">13</span>
  <span class="text-xs bg-primary text-white font-bold rounded-lg py-2">14</span>
  <span class="text-xs text-[#0d141b] dark:text-white py-2">15</span>
  <span class="text-xs text-[#0d141b] dark:text-white py-2">16</span>
  <span class="text-xs text-[#0d141b] dark:text-white py-2">17</span>
  <span class="text-xs text-[#0d141b] dark:text-white py-2">18</span>
  </div>
  </div>
  </div>
  <div class="flex-1 flex flex-col gap-4">
  <div class="flex items-center justify-between">
  <h4 class="text-[#0d141b] dark:text-white font-bold">Caregiver Notes</h4>
  <button class="text-primary text-xs font-bold">Add New</button>
  </div>
  <div class="space-y-4">
  <div class="p-3 bg-primary/5 rounded-lg border-l-4 border-primary">
  <p class="text-xs text-[#4c739a] mb-1">Today, 9:00 AM</p>
  <p class="text-sm text-[#0d141b] dark:text-slate-200">Mom complained of mild dizziness after the morning dose. Will monitor closely.</p>
  </div>
  <div class="p-3 bg-slate-50 dark:bg-slate-800 rounded-lg">
  <p class="text-xs text-[#4c739a] mb-1">Yesterday, 8:45 PM</p>
  <p class="text-sm text-[#0d141b] dark:text-slate-200">Refilled the weekly pill organizer. Ordered Atorvastatin refill from pharmacy.</p>
  </div>
  </div>
  </div>
  <div class="bg-background-light dark:bg-slate-800 rounded-xl p-4 flex flex-col gap-3">
  <p class="text-xs font-bold text-[#4c739a] uppercase">Quick Action</p>
  <div class="grid grid-cols-2 gap-2">
  <button class="flex flex-col items-center justify-center gap-2 p-3 bg-white dark:bg-slate-700 rounded-lg border border-[#cfdbe7] dark:border-slate-600 hover:border-primary transition-all">
  <span class="material-symbols-outlined text-primary">local_pharmacy</span>
  <span class="text-[10px] font-bold">Pharmacy</span>
  </button>
  <button class="flex flex-col items-center justify-center gap-2 p-3 bg-white dark:bg-slate-700 rounded-lg border border-[#cfdbe7] dark:border-slate-600 hover:border-primary transition-all">
  <span class="material-symbols-outlined text-primary">emergency</span>
  <span class="text-[10px] font-bold">SOS Help</span>
  </button>
  </div>
  </div>
  </aside>
  </div>
  <!-- Patient Profile Modal -->
<div id="patient-modal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
  <div class="bg-white dark:bg-slate-900 rounded-xl max-w-md w-full p-6 relative">
    <button id="close-patient-modal" class="absolute top-3 right-3 text-gray-500 hover:text-gray-800 dark:hover:text-white">
      &times;
    </button>
    <div class="flex flex-col items-center gap-4">
      <div id="modal-patient-photo" class="bg-center bg-no-repeat aspect-square w-24 h-24 rounded-full border-4 border-primary"></div>
      <h2 id="modal-patient-name" class="text-xl font-bold text-[#0d141b] dark:text-white"></h2>
      <p id="modal-patient-relation" class="text-sm text-[#4c739a] dark:text-slate-300"></p>
      <div class="grid grid-cols-2 gap-4 mt-4 w-full text-sm text-[#4c739a] dark:text-slate-300">
        <p><span class="font-semibold text-[#0d141b] dark:text-white">DOB:</span> <span id="modal-patient-dob"></span></p>
        <p><span class="font-semibold text-[#0d141b] dark:text-white">Gender:</span> <span id="modal-patient-gender"></span></p>
        <p><span class="font-semibold text-[#0d141b] dark:text-white">Blood Group:</span> <span id="modal-patient-blood"></span></p>
        <p><span class="font-semibold text-[#0d141b] dark:text-white">Height (cm):</span> <span id="modal-patient-height"></span></p>
        <p><span class="font-semibold text-[#0d141b] dark:text-white">Weight (kg):</span> <span id="modal-patient-weight"></span></p>
      </div>
    </div>
  </div>
</div>

  <script>
    // ====== Section Switching ======
const sidebarLinks = document.querySelectorAll('aside nav a[data-section]');
const allSections = document.querySelectorAll('main > div');

sidebarLinks.forEach(link => {
    link.addEventListener('click', (e) => {
        e.preventDefault();
        const section = link.getAttribute('data-section');

        // Hide all sections
        allSections.forEach(sec => sec.classList.add('hidden'));

        // Remove active class from sidebar links
        sidebarLinks.forEach(l => l.classList.remove('bg-primary/10', 'text-primary'));
        sidebarLinks.forEach(l => l.classList.add('text-[#4c739a]'));

        // Add active styles to clicked link
        link.classList.add('bg-primary/10', 'text-primary');

        // Show selected section
        if(section === 'dashboard') {
            document.querySelector('#section-dashboard').classList.remove('hidden');
        } else if(section === 'history') {
            document.querySelector('#section-medicine-history').classList.remove('hidden');

            // Fetch medicines when showing the section
            fetch('caretaker.php?action=getPatientMedicines', {credentials: 'same-origin'})
            .then(res => res.json())
            .then(res => {
                const list = document.getElementById('medicine-history-list');
                list.innerHTML = ''; // clear previous data

                if(res.status === 'success' && res.data.length) {
                    res.data.forEach(med => {
                        list.innerHTML += `
                            <div class="flex justify-between items-center p-4 rounded-xl border border-[#cfdbe7] dark:border-slate-800 bg-white dark:bg-slate-900 shadow-sm">
                                <div class="flex flex-col">
                                    <h4 class="text-lg font-bold text-[#0d141b] dark:text-white">${med.name}</h4>
                                    <p class="text-[#4c739a] text-sm">${med.dosage} • ${med.schedule}</p>
                                </div>
                                <span class="px-3 py-1 bg-primary/10 text-primary text-xs font-bold rounded-full">${med.status}</span>
                            </div>
                        `;
                    });
                } else {
                    list.innerHTML = '<p class="text-sm text-[#4c739a] dark:text-slate-300">No medicines found.</p>';
                }
            })
            .catch(err => console.error('Error fetching medicines:', err));
        }
    });
});

  document.addEventListener('DOMContentLoaded', () => {
      // ====== 1️⃣ Fetch Caretaker Profile ======
    fetch('caretaker.php?action=getCaretaker', {
      credentials: 'same-origin'
  })
          .then(res => res.json())
          .then(res => {
              if (res.status === 'success') {
                  const data = res.data;

                  // Set name and role
                  document.getElementById('caretaker-name').textContent = data.name;
                  document.getElementById('caretaker-role').textContent = data.role;

                  // Set photo (default if not available)
                  const photoDiv = document.getElementById('caretaker-photo');
                  photoDiv.innerHTML = ''; // remove the <span> icon
                  photoDiv.style.backgroundImage = `url('${data.profile_photo || 'default-avatar.png'}')`;
                  photoDiv.style.backgroundSize = 'cover';
                  photoDiv.style.backgroundPosition = 'center';
              } else {
                  console.error(res.message);
              }
          })
          .catch(err => console.error('Error fetching profile:', err));

      // ====== 2️⃣ Search Functionality ======
      const searchInput = document.querySelector('input[placeholder="Search medicine or notes..."]');

      // Wrap input in a relative container for absolute dropdown positioning
      const searchWrapper = document.createElement('div');
      searchWrapper.className = 'relative w-full';
      searchInput.parentNode.replaceWith(searchWrapper);
      searchWrapper.appendChild(searchInput);

      const searchResultsContainer = document.createElement('div');
      searchResultsContainer.className = "absolute top-full left-0 w-full bg-white dark:bg-slate-900 border border-slate-300 dark:border-slate-700 rounded-lg shadow-lg max-h-80 overflow-y-auto z-50 hidden";
      searchWrapper.appendChild(searchResultsContainer);

      let debounceTimeout;

      searchInput.addEventListener('input', () => {
          const query = searchInput.value.trim();
          clearTimeout(debounceTimeout);

          if (!query) {
              searchResultsContainer.innerHTML = '';
              searchResultsContainer.style.display = 'none';
              return;
          }

          debounceTimeout = setTimeout(() => {
            fetch(`caretaker.php?action=search&q=${encodeURIComponent(query)}`, {
      credentials: 'same-origin'
  })

                  .then(res => res.json())
                  .then(res => {
                      if (res.status === 'success') {
                          renderResults(res.results);
                      } else {
                          console.error(res.message);
                          searchResultsContainer.innerHTML = '';
                          searchResultsContainer.style.display = 'none';
                      }
                  })
                  .catch(err => console.error(err));
          }, 300); // debounce 300ms
      });

      function renderResults(results) {
          if (!results.length) {
              searchResultsContainer.innerHTML = '<p class="text-sm p-2 text-[#4c739a] dark:text-slate-300">No results found</p>';
          } else {
              searchResultsContainer.innerHTML = results.map(item => {
                  const icon = item.type === 'medicine' ? 'pill' : 'description';
                  return `
                      <div class="flex items-center gap-2 px-3 py-2 hover:bg-slate-100 dark:hover:bg-slate-800 cursor-pointer rounded-lg">
                          <span class="material-symbols-outlined text-sm text-primary">${icon}</span>
                          <div class="flex flex-col">
                              <p class="text-sm font-semibold text-[#0d141b] dark:text-white">${item.title}</p>
                              <p class="text-xs text-[#4c739a] dark:text-slate-300">${item.detail}</p>
                          </div>
                      </div>
                  `;
              }).join('');
          }
          searchResultsContainer.style.display = 'block';
      }

      // Hide search results when clicking outside
      document.addEventListener('click', (e) => {
          if (!searchResultsContainer.contains(e.target) && e.target !== searchInput) {
              searchResultsContainer.style.display = 'none';
          }
      });
  });
  // ====== 3️⃣ Fetch Assigned Patient Data ======
fetch('caretaker.php?action=getPatientProfile', {
    credentials: 'same-origin'
})
.then(res => res.json())
.then(res => {
    if(res.status === 'success') {
        const patient = res.data;

        // Set patient name and relation
        document.getElementById('patient-name').textContent = `${patient.patient_name} (${patient.relation})`;

        // Remove care status, adherence, last synced if not in DB
        document.getElementById('patient-care-status').textContent = 'Active Care';

        // Photo
        const photoDiv = document.getElementById('patient-photo');
        photoDiv.style.backgroundImage = `url('${patient.profile_photo || 'default-avatar.png'}')`;
        photoDiv.style.backgroundSize = 'cover';
        photoDiv.style.backgroundPosition = 'center';
    } else {
        console.error(res.message);
    }
})
.catch(err => console.error('Error fetching patient:', err));

// Slight tweak if needed
const patientModal = document.getElementById('patient-modal');
const closeModalBtn = document.getElementById('close-patient-modal');
const viewProfileBtn = document.getElementById('view-profile-btn');
viewProfileBtn.addEventListener('click', () => {
    fetch('caretaker.php?action=getPatientProfile', {
        credentials: 'same-origin'
    })
    .then(res => res.json())
    .then(res => {
        if(res.status === 'success') {
            const p = res.data;
            document.getElementById('modal-patient-name').textContent = p.patient_name;
            document.getElementById('modal-patient-relation').textContent = `Relation: ${p.relation}`;
            document.getElementById('modal-patient-dob').textContent = p.dob;
            document.getElementById('modal-patient-gender').textContent = p.gender;
            document.getElementById('modal-patient-blood').textContent = p.blood_group;
            document.getElementById('modal-patient-height').textContent = p.height_cm;
            document.getElementById('modal-patient-weight').textContent = p.weight_kg;

            const photoDiv = document.getElementById('modal-patient-photo');
            photoDiv.style.backgroundImage = `url('${p.profile_photo || 'default-avatar.png'}')`;
            photoDiv.style.backgroundSize = 'cover';
            photoDiv.style.backgroundPosition = 'center';

            patientModal.classList.remove('hidden'); // show modal
            patientModal.classList.add('flex');
        } else {
            alert(res.message);
        }
    })
    .catch(err => console.error(err));
});


// Close modal
closeModalBtn.addEventListener('click', () => {
    patientModal.classList.add('hidden');
    patientModal.classList.remove('flex');
});

// Optional: close modal on clicking outside
patientModal.addEventListener('click', (e) => {
    if(e.target === patientModal){
        patientModal.classList.add('hidden');
        patientModal.classList.remove('flex');
    }
});
const fullHistoryBtn = document.getElementById('full-history-btn');
fullHistoryBtn.addEventListener('click', () => {
    fetch('caretaker.php?action=getPatientProfile', {credentials: 'same-origin'})
    .then(res => res.json())
    .then(res => {
        if(res.status === 'success'){
            const patientId = res.data.patient_id;
            window.location.href = `medicine_history.php?patient_id=${patientId}`;
        } else {
            alert(res.message);
        }
    })
    .catch(err => console.error(err));
});
// ====== Medicine History Section ======
const historyLink = document.querySelector('[data-section="history"]');
const medicineHistorySection = document.getElementById('section-medicine-history');


historyLink.addEventListener('click', (e) => {
    e.preventDefault();

    // Hide other sections
    document.querySelectorAll('main > div').forEach(div => div.classList.add('hidden'));

    // Show medicine history section
    medicineHistorySection.classList.remove('hidden');

    // Fetch medicines for the assigned patient
    fetch('caretaker.php?action=getPatientMedicines', { credentials: 'same-origin' })
        .then(res => res.json())
        .then(res => {
            const list = document.getElementById('medicine-history-list');
            list.innerHTML = ''; // clear previous data

            if (res.status === 'success' && res.data.length) {
                res.data.forEach(med => {
                    const dosage = med.dosage || (med.dosage_value ? med.dosage_value + (med.dosage_unit || '') : '-');
                    list.innerHTML += `
                        <div class="flex justify-between items-center p-4 rounded-xl border border-[#cfdbe7] dark:border-slate-800 bg-white dark:bg-slate-900 shadow-sm mb-2">
                            <div class="flex flex-col">
                                <h4 class="text-lg font-bold text-[#0d141b] dark:text-white">${med.name}</h4>
                                <p class="text-[#4c739a] text-sm">
                                    Dosage: ${dosage} • 
                                    Type: ${med.medicine_type} • 
                                    Frequency: ${med.frequency || '-'}
                                </p>
                                ${med.instructions ? `<p class="text-[#4c739a] text-sm italic mt-1">Notes: ${med.instructions}</p>` : ''}
                            </div>
                            <span class="px-3 py-1 bg-primary/10 text-primary text-xs font-bold rounded-full">
                                Reminder: ${med.reminder_type || '-'}
                            </span>
                        </div>
                    `;
                });
            } else {
                list.innerHTML = '<p class="text-sm text-[#4c739a] dark:text-slate-300">No medicines found.</p>';
            }
        })
        .catch(err => console.error('Error fetching medicines:', err));
});

  </script>


  </body></html>
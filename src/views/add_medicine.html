<!DOCTYPE html>

<html class="light" lang="en">

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <title>Sushrusha - Add Medicine</title>
  <link href="https://fonts.googleapis.com" rel="preconnect" />
  <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&amp;display=swap"
    rel="stylesheet" />
  <link
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
    rel="stylesheet" />
  <link
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
    rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <script src="../../public/assets/translations.js"></script>
  <script src="../../public/assets/language-selector.js"></script>
  <script id="tailwind-config">
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            "primary": "#137fec",
            "background-light": "#f6f7f8",
            "background-dark": "#101922",
            "card-light": "#ffffff",
            "card-dark": "#182635",
            "input-border-light": "#cfdbe7",
            "input-border-dark": "#2d3b4e",
            "text-main-light": "#0d141b",
            "text-main-dark": "#e0e6ed",
            "text-sub-light": "#4c739a",
            "text-sub-dark": "#94a3b8",
          },
          fontFamily: {
            "display": ["Inter", "sans-serif"],
            "body": ["Inter", "sans-serif"]
          },
          borderRadius: { "DEFAULT": "0.5rem", "lg": "0.75rem", "xl": "1rem", "full": "9999px" },
        },
      },
    }
  </script>
</head>

<body
  class="bg-background-light dark:bg-background-dark text-text-main-light dark:text-text-main-dark font-display min-h-screen flex flex-col transition-colors duration-200">
  <!-- Top Navigation -->
  <header
    class="sticky top-0 z-50 w-full bg-card-light dark:bg-card-dark border-b border-input-border-light dark:border-input-border-dark shadow-sm">
    <div class="max-w-[1280px] mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <!-- Logo -->
        <div class="flex items-center gap-3">
          <div class="size-8 rounded-lg bg-primary/10 flex items-center justify-center text-primary">
            <span class="material-symbols-outlined text-2xl">local_hospital</span>
          </div>
          <span class="text-xl font-bold tracking-tight text-text-main-light dark:text-text-main-dark">Sushrusha</span>
        </div>
        <!-- Desktop Nav -->
        <nav class="hidden md:flex items-center gap-8">
          <a class="text-sm font-medium text-text-sub-light dark:text-text-sub-dark hover:text-primary dark:hover:text-primary transition-colors"
            href="dashboard.php">Dashboard</a>
          <a class="text-sm font-medium text-text-main-light dark:text-text-main-dark" href="#">Reminders</a>
          <!-- Active State -->
          <a class="text-sm font-medium text-text-sub-light dark:text-text-sub-dark hover:text-primary dark:hover:text-primary transition-colors"
            href="#">Reports</a>
          <a class="text-sm font-medium text-text-sub-light dark:text-text-sub-dark hover:text-primary dark:hover:text-primary transition-colors"
            href="#">Profile</a>
        </nav>
        <!-- Language Selector -->
        <div id="langSelectorPlaceholder" class="flex items-center"></div>
        <!-- User Profile -->
        <div class="flex items-center gap-4">
          <button
            class="p-2 text-text-sub-light dark:text-text-sub-dark hover:bg-background-light dark:hover:bg-background-dark rounded-full transition-colors">
            <span class="material-symbols-outlined">notifications</span>
          </button>
          <div
            class="size-9 rounded-full bg-cover bg-center border border-input-border-light dark:border-input-border-dark cursor-pointer"
            data-alt="Portrait of a smiling male user"
            style="background-image: url('https://lh3.googleusercontent.com/aida-public/AB6AXuAb8YJD0lIvx5ydgnMIf7VnNBPErUu3MTQ6bCNwnzinkOy2Y_fUNgn31JWjHneVR8cNxrz4Rm28xqhF4teoMj1LtN6Vsqv-wphvS2rwqY7hzOaZX6-sxGDq9vSW3u-TcRuWSqipmk9dGyuba4PEls_cEZCdQkP18okvItGky2Jbd0gJs4K2ekR576bDAWjQxnPWua3NR3UAOdRNyuk-7jLTGCTA0ozy11KxtOLuyvPFEpE9_SuoAPX7YekhGPxwoxjiytEbDKXcX_g');">
          </div>
        </div>
      </div>
    </div>
  </header>
  <!-- Main Layout -->
  <main class="flex-1 w-full max-w-[960px] mx-auto px-4 py-8 sm:px-6 lg:px-8">
    <!-- Breadcrumbs -->
    <nav aria-label="Breadcrumb" class="flex mb-6">
      <ol class="inline-flex items-center space-x-1 md:space-x-2">
        <li class="inline-flex items-center">
          <a class="text-sm font-medium text-text-sub-light dark:text-text-sub-dark hover:text-primary" href="#">
            Dashboard
          </a>
        </li>
        <li>
          <div class="flex items-center">
            <span
              class="material-symbols-outlined text-text-sub-light dark:text-text-sub-dark text-lg mx-1">chevron_right</span>
            <a class="text-sm font-medium text-text-sub-light dark:text-text-sub-dark hover:text-primary"
              href="#">Reminders</a>
          </div>
        </li>
        <li aria-current="page">
          <div class="flex items-center">
            <span
              class="material-symbols-outlined text-text-sub-light dark:text-text-sub-dark text-lg mx-1">chevron_right</span>
            <span class="text-sm font-medium text-primary">Add Medicine</span>
          </div>
        </li>
      </ol>
    </nav>
    <!-- Page Heading -->
    <div class="mb-8">
      <h1 class="text-3xl sm:text-4xl font-black text-text-main-light dark:text-text-main-dark tracking-tight mb-3">Add
        New Medication</h1>
      <p class="text-base sm:text-lg text-text-sub-light dark:text-text-sub-dark">Enter the details below to set up your
        smart reminders and tracking.</p>
    </div>
    <!-- Form Container -->
    <form class="flex flex-col gap-6">

      <!-- Section 1: Medicine Details -->
      <div
        class="bg-card-light dark:bg-card-dark rounded-xl border border-input-border-light dark:border-input-border-dark shadow-sm overflow-hidden">
        <div
          class="px-6 py-4 border-b border-input-border-light dark:border-input-border-dark flex items-center gap-3 bg-background-light/50 dark:bg-background-dark/50">
          <div class="bg-primary/10 p-2 rounded-lg text-primary">
            <span class="material-symbols-outlined">medication</span>
          </div>
          <h2 class="text-lg font-bold text-text-main-light dark:text-text-main-dark">Medicine Details</h2>
        </div>
        <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-6">

          <!-- Medicine Name -->
          <div class="space-y-2 col-span-1 md:col-span-2 relative">
            <label class="block text-sm font-semibold text-text-main-light dark:text-text-main-dark"
              for="medName">Medicine Name</label>
            <div class="flex gap-2 items-center">
              <input id="medName" name="medName"
                class="w-full h-12 px-4 rounded-lg bg-background-light dark:bg-background-dark border border-input-border-light dark:border-input-border-dark text-text-main-light dark:text-text-main-dark focus:ring-2 focus:ring-primary/20 focus:border-primary placeholder:text-text-sub-light/70 transition-all outline-none"
                placeholder="Type medicine name..." type="text" autocomplete="off" />

              <!-- Request New Medicine Button -->
              <button type="button" id="requestNewMed"
                class="px-3 py-2 bg-primary text-white rounded-lg hover:bg-blue-600 transition-colors flex items-center gap-1">
                <span class="material-symbols-outlined text-lg">add</span>Request
              </button>
            </div>

            <!-- Autocomplete Dropdown -->

            <ul id="medSuggestions"
              class="absolute z-50 w-full bg-background-light dark:bg-background-dark border border-input-border-light dark:border-input-border-dark rounded-lg mt-1 max-h-48 overflow-auto hidden">
            </ul>
            <p id="medNotFound" class="hidden mt-1 text-sm text-red-500">
              ‚ùå Medicine not found
            </p>


          </div>

          <!-- Dosage -->
          <div class="space-y-2">
            <label class="block text-sm font-semibold text-text-main-light dark:text-text-main-dark"
              for="dosage">Dosage</label>
            <select id="dosage" name="dosage"
              class="w-full h-12 px-4 rounded-lg bg-background-light dark:bg-background-dark border border-input-border-light dark:border-input-border-dark text-text-main-light dark:text-text-main-dark focus:ring-2 focus:ring-primary/20 focus:border-primary outline-none">
              <option value="">Select dosage</option>
            </select>
          </div>

          <!-- Medicine Form -->
          <div class="space-y-2">
            <label class="block text-sm font-semibold text-text-main-light dark:text-text-main-dark">Form</label>
            <div class="grid grid-cols-3 gap-3">
              <label class="cursor-pointer relative group">
                <input checked name="form" value="Pill" class="peer sr-only" type="radio" />
                <div
                  class="h-12 flex items-center justify-center gap-2 rounded-lg border border-input-border-light dark:border-input-border-dark bg-background-light dark:bg-background-dark peer-checked:bg-primary/10 peer-checked:border-primary peer-checked:text-primary text-text-sub-light transition-all hover:bg-gray-100 dark:hover:bg-gray-800">
                  <span class="material-symbols-outlined text-lg">pill</span>
                  <span class="text-sm font-medium">Pill</span>
                </div>
              </label>
              <label class="cursor-pointer relative group">
                <input name="form" value="Liquid" class="peer sr-only" type="radio" />
                <div
                  class="h-12 flex items-center justify-center gap-2 rounded-lg border border-input-border-light dark:border-input-border-dark bg-background-light dark:bg-background-dark peer-checked:bg-primary/10 peer-checked:border-primary peer-checked:text-primary text-text-sub-light transition-all hover:bg-gray-100 dark:hover:bg-gray-800">
                  <span class="material-symbols-outlined text-lg">water_drop</span>
                  <span class="text-sm font-medium">Liquid</span>
                </div>
              </label>
              <label class="cursor-pointer relative group">
                <input name="form" value="Injection" class="peer sr-only" type="radio" />
                <div
                  class="h-12 flex items-center justify-center gap-2 rounded-lg border border-input-border-light dark:border-input-border-dark bg-background-light dark:bg-background-dark peer-checked:bg-primary/10 peer-checked:border-primary peer-checked:text-primary text-text-sub-light transition-all hover:bg-gray-100 dark:hover:bg-gray-800">
                  <span class="material-symbols-outlined text-lg">syringe</span>
                  <span class="text-sm font-medium">Injection</span>
                </div>
              </label>
            </div>
          </div>

        </div>
      </div>

      <!-- Section 2: Schedule & Frequency -->
      <div
        class="bg-card-light dark:bg-card-dark rounded-xl border border-input-border-light dark:border-input-border-dark shadow-sm overflow-hidden">
        <div
          class="px-6 py-4 border-b border-input-border-light dark:border-input-border-dark flex items-center gap-3 bg-background-light/50 dark:bg-background-dark/50">
          <div class="bg-primary/10 p-2 rounded-lg text-primary">
            <span class="material-symbols-outlined">calendar_month</span>
          </div>
          <h2 class="text-lg font-bold text-text-main-light dark:text-text-main-dark">Schedule &amp; Frequency</h2>
        </div>
        <div class="p-6 space-y-6">

          <!-- Frequency -->
          <div class="space-y-3">
            <label class="block text-sm font-semibold text-text-main-light dark:text-text-main-dark" for="frequency">How
              often?</label>
            <select name="frequency" id="frequency"
              class="h-12 px-4 rounded-lg bg-background-light dark:bg-background-dark border border-input-border-light dark:border-input-border-dark text-text-main-light dark:text-text-main-dark focus:ring-2 focus:ring-primary/20 focus:border-primary outline-none w-full md:w-auto min-w-[200px]">
              <option value="Daily">Daily</option>
              <option value="Weekly">Weekly</option>
              <option value="Specific Days">Specific Days</option>
              <option value="As Needed">As Needed</option>
            </select>
          </div>

          <!-- Specific Days -->
          <div class="flex gap-2 flex-wrap">
            <input type="checkbox" name="specific_days[]" value="M" id="dayM" class="hidden day-checkbox">
            <label for="dayM"
              class="size-12 rounded-full border border-input-border-light dark:border-input-border-dark flex items-center justify-center text-sm font-medium text-text-sub-light hover:border-primary hover:text-primary bg-background-light dark:bg-background-dark cursor-pointer transition-all">M</label>

            <input type="checkbox" name="specific_days[]" value="T" id="dayT" class="hidden day-checkbox">
            <label for="dayT"
              class="size-12 rounded-full border border-input-border-light dark:border-input-border-dark flex items-center justify-center text-sm font-medium text-text-sub-light hover:border-primary hover:text-primary bg-background-light dark:bg-background-dark cursor-pointer transition-all">T</label>

            <input type="checkbox" name="specific_days[]" value="W" id="dayW" class="hidden day-checkbox">
            <label for="dayW"
              class="size-12 rounded-full border border-input-border-light dark:border-input-border-dark flex items-center justify-center text-sm font-medium text-text-sub-light hover:border-primary hover:text-primary bg-background-light dark:bg-background-dark cursor-pointer transition-all">W</label>

            <input type="checkbox" name="specific_days[]" value="T" id="dayTh" class="hidden day-checkbox">
            <label for="dayTh"
              class="size-12 rounded-full border border-input-border-light dark:border-input-border-dark flex items-center justify-center text-sm font-medium text-text-sub-light hover:border-primary hover:text-primary bg-background-light dark:bg-background-dark cursor-pointer transition-all">T</label>

            <input type="checkbox" name="specific_days[]" value="F" id="dayF" class="hidden day-checkbox">
            <label for="dayF"
              class="size-12 rounded-full border border-input-border-light dark:border-input-border-dark flex items-center justify-center text-sm font-medium text-text-sub-light hover:border-primary hover:text-primary bg-background-light dark:bg-background-dark cursor-pointer transition-all">F</label>

            <input type="checkbox" name="specific_days[]" value="S" id="dayS" class="hidden day-checkbox">
            <label for="dayS"
              class="size-12 rounded-full border border-input-border-light dark:border-input-border-dark flex items-center justify-center text-sm font-medium text-text-sub-light hover:border-primary hover:text-primary bg-background-light dark:bg-background-dark cursor-pointer transition-all">S</label>

            <input type="checkbox" name="specific_days[]" value="S" id="daySu" class="hidden day-checkbox">
            <label for="daySu"
              class="size-12 rounded-full border border-input-border-light dark:border-input-border-dark flex items-center justify-center text-sm font-medium text-text-sub-light hover:border-primary hover:text-primary bg-background-light dark:bg-background-dark cursor-pointer transition-all">S</label>
          </div>

          <hr class="border-input-border-light dark:border-input-border-dark border-dashed" />

          <!-- Reminder Times Section -->
          <div
            class="bg-card-light dark:bg-card-dark rounded-xl border border-input-border-light dark:border-input-border-dark shadow-sm overflow-hidden">
            <div
              class="px-6 py-4 border-b border-input-border-light dark:border-input-border-dark flex items-center gap-3 bg-background-light/50 dark:bg-background-dark/50">
              <div class="bg-primary/10 p-2 rounded-lg text-primary">
                <span class="material-symbols-outlined">schedule</span>
              </div>
              <h2 class="text-lg font-bold text-text-main-light dark:text-text-main-dark">Reminder Times</h2>
            </div>

            <div class="p-6 space-y-4">
              <!-- Reminder Mode -->
              <div class="space-y-2">
                <label class="block text-sm font-semibold text-text-main-light dark:text-text-main-dark">Reminder
                  Type</label>
                <div class="flex gap-4">
                  <label class="cursor-pointer flex items-center gap-2">
                    <input type="radio" name="reminder_mode" value="fixed" checked class="peer sr-only">
                    <div
                      class="px-3 py-2 rounded-lg border border-input-border-light dark:border-input-border-dark peer-checked:border-primary peer-checked:bg-primary/10 peer-checked:text-primary text-text-sub-light hover:bg-gray-100 dark:hover:bg-gray-800 transition-all">
                      Fixed Times
                    </div>
                  </label>
                  <label class="cursor-pointer flex items-center gap-2">
                    <input type="radio" name="reminder_mode" value="interval" class="peer sr-only">
                    <div
                      class="px-3 py-2 rounded-lg border border-input-border-light dark:border-input-border-dark peer-checked:border-primary peer-checked:bg-primary/10 peer-checked:text-primary text-text-sub-light hover:bg-gray-100 dark:hover:bg-gray-800 transition-all">
                      Interval-based
                    </div>
                  </label>
                </div>
              </div>

              <!-- Fixed Times Picker -->
              <div id="fixed-times-container" class="space-y-3">
                <div class="flex items-center justify-between">
                  <label class="block text-sm font-semibold text-text-main-light dark:text-text-main-dark">Times</label>
                  <button type="button" id="addFixedTimeBtn"
                    class="text-sm text-primary font-medium hover:text-blue-600 flex items-center gap-1">
                    <span class="material-symbols-outlined text-lg">add_circle</span>Add Time
                  </button>
                </div>
                <div class="flex flex-wrap gap-4" id="fixedTimesInputs">
                  <input name="times[]" type="time" value="08:00"
                    class="bg-background-light dark:bg-background-dark border border-input-border-light dark:border-input-border-dark rounded-lg p-2" />
                  <input name="times[]" type="time" value="20:00"
                    class="bg-background-light dark:bg-background-dark border border-input-border-light dark:border-input-border-dark rounded-lg p-2" />
                </div>
              </div>

              <!-- Interval Picker -->
              <div id="interval-container" class="space-y-3 hidden">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
                  <div class="space-y-2">
                    <label class="block text-sm font-semibold text-text-main-light dark:text-text-main-dark"
                      for="intervalStart">Start Time</label>
                    <input type="time" id="intervalStart" name="intervalStart" value="08:00"
                      class="w-full h-12 px-4 rounded-lg bg-background-light dark:bg-background-dark border border-input-border-light dark:border-input-border-dark text-text-main-light dark:text-text-main-dark focus:ring-2 focus:ring-primary/20 focus:border-primary outline-none" />
                  </div>
                  <div class="space-y-2">
                    <label class="block text-sm font-semibold text-text-main-light dark:text-text-main-dark"
                      for="intervalHours">Interval (hours)</label>
                    <input type="number" id="intervalHours" name="intervalHours" min="1" max="24" value="8"
                      class="w-full h-12 px-4 rounded-lg bg-background-light dark:bg-background-dark border border-input-border-light dark:border-input-border-dark text-text-main-light dark:text-text-main-dark focus:ring-2 focus:ring-primary/20 focus:border-primary outline-none" />
                  </div>
                  <div class="space-y-2">
                    <label class="block text-sm font-semibold text-text-main-light dark:text-text-main-dark">Generated
                      Times</label>
                    <div id="generatedTimes"
                      class="p-2 bg-background-light dark:bg-background-dark border border-input-border-light dark:border-input-border-dark rounded-lg min-h-[50px] text-text-sub-light dark:text-text-sub-dark">
                    </div>
                  </div>
                </div>
              </div>



              <hr class="border-input-border-light dark:border-input-border-dark border-dashed" />

              <!-- Duration Dates -->
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="space-y-2">
                  <label class="block text-sm font-semibold text-text-main-light dark:text-text-main-dark"
                    for="start_date">Start Date</label>
                  <input id="start_date" name="start_date" type="date"
                    class="w-full h-12 px-4 rounded-lg bg-background-light dark:bg-background-dark border border-input-border-light dark:border-input-border-dark text-text-main-light dark:text-text-main-dark focus:ring-2 focus:ring-primary/20 focus:border-primary outline-none" />
                </div>
                <div class="space-y-2">
                  <label class="block text-sm font-semibold text-text-main-light dark:text-text-main-dark"
                    for="end_date">End Date (Optional)</label>
                  <input id="end_date" name="end_date" type="date"
                    class="w-full h-12 px-4 rounded-lg bg-background-light dark:bg-background-dark border border-input-border-light dark:border-input-border-dark text-text-main-light dark:text-text-main-dark focus:ring-2 focus:ring-primary/20 focus:border-primary outline-none" />
                </div>
              </div>

              <!-- Compartment Number -->
              <div class="space-y-2">
                <label class="block text-sm font-semibold text-text-main-light dark:text-text-main-dark"
                  for="compartment_number">
                  Compartment Number
                </label>

                <select id="compartment_number" name="compartment_number"
                  class="w-full h-12 px-4 rounded-lg bg-background-light dark:bg-background-dark border border-input-border-light dark:border-input-border-dark text-text-main-light dark:text-text-main-dark focus:ring-2 focus:ring-primary/20 focus:border-primary outline-none"
                  required>
                  <option value="" disabled selected>Select compartment</option>
                  <option value="1">Compartment 1</option>
                  <option value="2">Compartment 2</option>
                  <option value="3">Compartment 3</option>
                  <option value="4">Compartment 4</option>
                </select>
              </div>


            </div>
          </div>

          <!-- Section 3: Instructions & Notes -->
          <div
            class="bg-card-light dark:bg-card-dark rounded-xl border border-input-border-light dark:border-input-border-dark shadow-sm overflow-hidden">
            <div
              class="px-6 py-4 border-b border-input-border-light dark:border-input-border-dark flex items-center gap-3 bg-background-light/50 dark:bg-background-dark/50">
              <div class="bg-primary/10 p-2 rounded-lg text-primary">
                <span class="material-symbols-outlined">notes</span>
              </div>
              <h2 class="text-lg font-bold text-text-main-light dark:text-text-main-dark">Instructions &amp; Notes</h2>
            </div>
            <div class="p-6">
              <div class="space-y-2">
                <label class="block text-sm font-semibold text-text-main-light dark:text-text-main-dark"
                  for="instructions">Special Instructions</label>
                <textarea id="instructions" name="instructions" rows="4"
                  placeholder="e.g. Take with food, avoid sunlight..."
                  class="w-full p-4 rounded-lg bg-background-light dark:bg-background-dark border border-input-border-light dark:border-input-border-dark text-text-main-light dark:text-text-main-dark focus:ring-2 focus:ring-primary/20 focus:border-primary placeholder:text-text-sub-light/70 transition-all outline-none resize-none"></textarea>
              </div>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="flex items-center justify-end gap-4 py-4">
            <button
              class="px-6 py-3 rounded-lg text-sm font-semibold text-text-sub-light dark:text-text-sub-dark hover:text-text-main-light dark:hover:text-text-main-dark transition-colors"
              type="button">Cancel</button>
            <button
              class="px-8 py-3 rounded-lg text-sm font-bold text-white bg-primary hover:bg-blue-600 shadow-lg shadow-blue-500/30 transition-all transform hover:-translate-y-0.5 active:translate-y-0 flex items-center gap-2"
              type="submit">
              <span class="material-symbols-outlined text-lg">check</span>Save Medicine
            </button>
          </div>

    </form>

  </main>
  <footer
    class="mt-auto py-6 border-t border-input-border-light dark:border-input-border-dark bg-card-light dark:bg-card-dark text-center">
    <p class="text-sm text-text-sub-light dark:text-text-sub-dark">¬© 2026 Sushrusha Health. All rights reserved.</p>
  </footer>
  <div id="requestModal" class="fixed inset-0 bg-black/50 hidden flex items-center justify-center z-50">
    <div class="bg-card-light dark:bg-card-dark rounded-xl w-full max-w-md p-6">
      <h2 class="text-xl font-bold mb-4">Request New Medicine</h2>

      <form id="requestMedForm" class="space-y-4">
        <input name="name" required placeholder="Medicine name" class="w-full h-12 px-4 rounded-lg border" />

        <input name="dosage" required placeholder="Dosage (e.g. 500mg)" class="w-full h-12 px-4 rounded-lg border" />

        <select name="form" required class="w-full h-12 px-4 rounded-lg border">
          <option value="">Select form</option>
          <option value="Pill">Pill</option>
          <option value="Liquid">Liquid</option>
          <option value="Injection">Injection</option>
        </select>

        <div class="flex justify-end gap-3">
          <button type="button" id="closeModal">Cancel</button>
          <button type="submit" class="px-5 py-2 bg-primary text-white rounded-lg">
            Send Request
          </button>
        </div>
      </form>
    </div>
  </div>
  <!-- Custom Alert / Toast -->
  <div id="toast"
    class="fixed top-6 right-6 z-[9999] hidden max-w-sm rounded-2xl shadow-lg border p-4 flex items-start gap-3 transition-all">

    <span id="toastIcon" class="material-symbols-outlined text-xl"></span>

    <div class="flex-1">
      <p id="toastMessage" class="text-sm font-medium"></p>
    </div>

    <button onclick="hideToast()" class="text-textSub hover:text-textMain">
      <span class="material-symbols-outlined text-lg">close</span>
    </button>
  </div>


  <script>
    document.addEventListener("DOMContentLoaded", () => {

      /* ===============================
         ELEMENT REFERENCES
      =============================== */
      const form = document.querySelector("form");

      const medInput = document.getElementById("medName");
      const suggestions = document.getElementById("medSuggestions");
      const dosageSelect = document.getElementById("dosage");
      const formRadios = document.querySelectorAll('input[name="form"]');

      const frequencySelect = document.getElementById("frequency");
      const dayCheckboxes = document.querySelectorAll('input[name="specific_days[]"]');

      const fixedTimesContainer = document.getElementById("fixed-times-container");
      const intervalContainer = document.getElementById("interval-container");
      const addFixedTimeBtn = document.getElementById("addFixedTimeBtn");
      const fixedTimesInputs = document.getElementById("fixedTimesInputs");

      const intervalStart = document.getElementById("intervalStart");
      const intervalHours = document.getElementById("intervalHours");
      const generatedTimes = document.getElementById("generatedTimes");

      let allDosages = [];
      let medicineFound = false;
      let clickingSuggestion = false;
      const medNotFound = document.getElementById("medNotFound");

      /* ===============================
         MEDICINE AUTOCOMPLETE
      =============================== */
      medInput.addEventListener("input", async () => {
        const query = medInput.value.trim();
        suggestions.innerHTML = "";
        dosageSelect.innerHTML = '<option value="">Select dosage</option>';
        allDosages = [];

        if (!query) {
          suggestions.classList.add("hidden");
          return;
        }

        const res = await fetch(`medicines_autocomplete.php?query=${encodeURIComponent(query)}`);
        const data = await res.json();
        medicineFound = data.length > 0;

        if (!medicineFound) {
          suggestions.classList.add("hidden");

          if (!medicineFound) {
            suggestions.classList.add("hidden");

            // show inline error
            medNotFound.classList.remove("hidden");
            medInput.classList.add("border-red-500");

            dosageSelect.innerHTML = '<option value="">Select dosage</option>';
            return;
          }

        }



        data.forEach(med => {
          const li = document.createElement("li");
          li.textContent = med.name;
          li.className = "px-4 py-2 hover:bg-primary/20 cursor-pointer";
          li.onmousedown = () => {
            clickingSuggestion = true;
          };

          li.onclick = () => {
            medInput.value = med.name;
            suggestions.classList.add("hidden");
            medicineFound = true;
            medNotFound.classList.add("hidden");
            medInput.classList.remove("border-red-500");

            loadDosages(med.name);

            setTimeout(() => clickingSuggestion = false, 0);
          };


          suggestions.appendChild(li);
        });

        suggestions.classList.remove("hidden");
      });

      document.addEventListener("click", e => {
        if (!medInput.contains(e.target) && !suggestions.contains(e.target)) {
          suggestions.classList.add("hidden");
        }
      });



      async function loadDosages(medicine) {
        const res = await fetch(`medicines_autocomplete.php?medicine=${encodeURIComponent(medicine)}`);
        const data = await res.json();
        allDosages = data;

        dosageSelect.innerHTML = '<option value="">Select dosage</option>';

        const forms = new Set();
        data.forEach(d => forms.add(d.form));

        data.forEach(d => {
          const opt = document.createElement("option");
          opt.value = d.dosage;
          opt.textContent = d.dosage;
          opt.dataset.form = d.form;
          dosageSelect.appendChild(opt);
        });

        if (forms.size === 1) {
          const onlyForm = [...forms][0];
          formRadios.forEach(r => r.checked = r.value === onlyForm);
        } else {
          formRadios.forEach(r => r.checked = false);
        }

        filterDosages();
      }

      function filterDosages() {
        const selectedForm = document.querySelector('input[name="form"]:checked')?.value;

        // Clear the dropdown first
        dosageSelect.innerHTML = '<option value="">Select dosage</option>';

        if (!selectedForm) return;

        // Filter for dosages that match selected form
        const filtered = allDosages.filter(d => d.form === selectedForm);

        if (filtered.length === 0) {
          // No dosages for this form
          const opt = document.createElement("option");
          opt.value = "";
          opt.textContent = "No dosage available";
          opt.disabled = true;
          dosageSelect.appendChild(opt);
          return;
        }

        filtered.forEach(d => {
          const opt = document.createElement("option");
          opt.value = d.dosage;
          opt.textContent = d.dosage;
          dosageSelect.appendChild(opt);
        });
      }

      formRadios.forEach(r => r.addEventListener("change", filterDosages));

      /* ===============================
         FREQUENCY ‚Üí DAYS LOGIC
      =============================== */
      function updateDays() {
        const isDaily = frequencySelect.value === "Daily";

        dayCheckboxes.forEach(cb => {
          if (isDaily) {
            cb.checked = true;     // auto-select
            cb.disabled = true;   // lock
            cb.nextElementSibling.classList.add(
              "bg-primary/20", "border-primary", "text-primary", "opacity-60"
            );
          } else {
            cb.disabled = false;
            cb.checked = false;

            cb.nextElementSibling.classList.remove(
              "bg-primary/20",
              "border-primary",
              "text-primary",
              "opacity-60"
            );
          }


        });
      }
      dayCheckboxes.forEach(cb => {
        cb.addEventListener("change", () => {
          const label = cb.nextElementSibling;

          if (cb.checked) {
            label.classList.add(
              "bg-primary/20",
              "border-primary",
              "text-primary"
            );
          } else {
            label.classList.remove(
              "bg-primary/20",
              "border-primary",
              "text-primary"
            );
          }
        });
      });

      updateDays(); // run once on page load
      frequencySelect.addEventListener("change", updateDays);

      /* ===============================
         REMINDER TYPE TOGGLE
      =============================== */
      /* ===============================
         REMINDER TYPE TOGGLE (Modified)
      =============================== */
      function updateReminderUI() {
        const freq = frequencySelect.value;
        const isAsNeeded = freq === "As Needed";

        // 1. Handle "As Needed"
        if (isAsNeeded) {
          // Force manual mode internally
          const manualRadio = document.querySelector('input[name="reminder_mode"][value="manual"]');
          // If you don't have a manual radio, user can't select it, so we might need to handle this via hidden input or backend.
          // For visual: Hide both fixed and interval containers
          fixedTimesContainer.classList.add("hidden");
          intervalContainer.classList.add("hidden");

          // Hide the radio buttons themselves too if desired, or just the section
          document.querySelector('.bg-card-light h2:contains("Reminder Times")')?.closest('.bg-card-light').classList.add("hidden");
          // Actually, let's just hide the content container of that section or distinctive parts
          document.querySelectorAll('input[name="reminder_mode"]').forEach(r => r.closest('label').classList.add('hidden'));

        } else {
          // Show radios
          document.querySelectorAll('input[name="reminder_mode"]').forEach(r => r.closest('label').classList.remove('hidden'));

          // Trigger normal toggle
          const currentMode = document.querySelector('input[name="reminder_mode"]:checked')?.value || 'fixed';
          fixedTimesContainer.classList.toggle("hidden", currentMode !== "fixed");
          intervalContainer.classList.toggle("hidden", currentMode !== "interval");
        }
      }

      document.querySelectorAll('input[name="reminder_mode"]').forEach(radio => {
        radio.addEventListener("change", updateReminderUI);
      });

      // Hook into frequency change too
      frequencySelect.addEventListener("change", () => {
        updateDays();
        updateReminderUI();
      });

      // Initial run
      updateReminderUI();

      /* ===============================
         FIXED TIME ADD / REMOVE
      =============================== */
      addFixedTimeBtn.addEventListener("click", () => {
        const wrap = document.createElement("div");
        wrap.className = "flex items-center gap-2";

        wrap.innerHTML = `
      <input type="time" name="times[]" value="08:00"
        class="bg-background-light border rounded-lg p-2"/>
      <span class="material-symbols-outlined cursor-pointer text-red-500">close</span>
    `;

        wrap.querySelector("span").onclick = () => wrap.remove();
        fixedTimesInputs.appendChild(wrap);
      });

      /* ===============================
         INTERVAL GENERATOR
      =============================== */
      function generateIntervals() {
        const start = intervalStart.value;
        const interval = parseInt(intervalHours.value);

        if (!start || isNaN(interval) || interval < 1 || interval > 24) {
          generatedTimes.textContent = "";
          return;
        }

        const [startH, startM] = start.split(":").map(Number);
        let currentH = startH;
        let currentM = startM;

        const times = [];

        while (currentH < 24) {
          const hh = String(currentH).padStart(2, "0");
          const mm = String(currentM).padStart(2, "0");
          times.push(`${hh}:${mm}`);
          currentH += interval;
        }

        generatedTimes.textContent = times.join(", ");
      }

      // üî• LISTEN FOR CHANGES
      intervalStart.addEventListener("input", generateIntervals);
      intervalHours.addEventListener("input", generateIntervals);

      // Initial call
      generateIntervals();


      /* ===============================
         FORM SUBMISSION (üî• IMPORTANT)
      =============================== */

      // Load available compartments
      async function loadAvailableCompartments() {
        try {
          const res = await fetch("../helpers/get_compartment_status.php");
          const data = await res.json();

          if (data.status === 'success') {
            const compartmentSelect = document.getElementById('compartment_number');
            const options = compartmentSelect.querySelectorAll('option');

            // Update options - disable occupied ones
            options.forEach(opt => {
              if (opt.value) {
                const compartmentNum = parseInt(opt.value);
                const isOccupied = data.occupied_compartments.includes(compartmentNum);

                if (isOccupied) {
                  opt.disabled = true;
                  opt.textContent = `Compartment ${compartmentNum} (Occupied)`;
                  opt.style.backgroundColor = '#fee2e2';
                  opt.style.color = '#991b1b';
                } else {
                  opt.disabled = false;
                  opt.textContent = `Compartment ${compartmentNum} (Available)`;
                  opt.style.backgroundColor = '#f0fdf4';
                  opt.style.color = '#166534';
                }
              }
            });
          }
        } catch (err) {
          console.error('Error loading compartment status:', err);
        }
      }

      // Load compartments on page load
      loadAvailableCompartments();

      // Reload compartments every 5 seconds to stay in sync
      setInterval(loadAvailableCompartments, 5000);

      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        // Validate compartment is selected
        const compartmentSelect = document.getElementById('compartment_number');
        if (!compartmentSelect.value) {
          showToast("Please select a compartment", "error");
          return;
        }

        if (compartmentSelect.options[compartmentSelect.selectedIndex].disabled) {
          showToast("Selected compartment is occupied. Please choose another.", "error");
          return;
        }

        // üî• STRICT VALIDATION START

        // 1. Dates
        const startStr = document.getElementById('start_date').value;
        const endStr = document.getElementById('end_date').value;

        if (!startStr) {
          showToast("Start date is required", "error");
          return;
        }

        const today = new Date().toISOString().split('T')[0];
        if (startStr < today) {
          showToast("Start date cannot be in the past", "error");
          return;
        }

        if (endStr && endStr < startStr) {
          showToast("End date must be after start date", "error");
          return;
        }

        // 2. Frequency / Reminder Times
        const freq = frequencySelect.value;
        if (freq !== "As Needed") {
          const mode = document.querySelector('input[name="reminder_mode"]:checked')?.value;
          if (mode === "fixed") {
            const times = document.querySelectorAll('input[name="times[]"]');
            let hasTime = false;
            times.forEach(t => { if (t.value) hasTime = true; });
            if (!hasTime) {
              showToast("Please add at least one reminder time", "error");
              return;
            }
          } else if (mode === "interval") {
            if (!intervalStart.value || !intervalHours.value) {
              showToast("Interval settings are incomplete", "error");
              return;
            }
          }
        }
        // üî• STRICT VALIDATION END

        const formData = new FormData(form);

        try {
          const res = await fetch("add_medicine.php", {
            method: "POST",
            body: formData,
            credentials: "same-origin"
          });

          const data = await res.json();
          console.log("SERVER:", data);

          if (data.status === "success") {
            showToast("Medicine added successfully", "success");

            // Reload compartments after successful addition
            setTimeout(() => {
              loadAvailableCompartments();
            }, 500);

            form.reset();
          } else {
            showToast("‚ùå " + (data.message || "Failed"));
          }
        } catch (err) {
          console.error(err);
          showToast("‚ùå Server error");
        }
      });

      // Initialize Language Selector and Translation System
      // Initialize Language Selector and Translation System
      initLanguageSelector('#langSelectorPlaceholder');
      initTranslationSystem();
      //request medicine
      const requestBtn = document.getElementById("requestNewMed");
      const modal = document.getElementById("requestModal");
      const closeModal = document.getElementById("closeModal");

      requestBtn.onclick = () => {
        modal.classList.remove("hidden");
        modal.classList.add("flex");
      };

      closeModal.onclick = () => {
        modal.classList.add("hidden");
        modal.classList.remove("flex");
      };


      document.getElementById("requestMedForm").addEventListener("submit", async e => {
        e.preventDefault();

        const formData = new FormData(e.target);

        const res = await fetch("request_medicine.php", {
          method: "POST",
          body: formData
        });

        const data = await res.json();

        if (data.status === "success") {
          showToast("‚úÖ Request sent to admin");
          modal.classList.add("hidden");
          e.target.reset();
        } else {
          showToast("‚ùå " + data.message);
        }
      });

    });

    // Auto-select compartment from URL parameter
    function initializeCompartmentFromURL() {
      const urlParams = new URLSearchParams(window.location.search);
      const compartmentId = urlParams.get('compartment');

      if (compartmentId) {
        const compartmentSelect = document.getElementById('compartment_number');
        // Wait for compartment dropdown to be loaded
        setTimeout(() => {
          compartmentSelect.value = compartmentId;
          // Scroll to compartment field
          compartmentSelect.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }, 500);
      }
    }

    // Call on page load
    initializeCompartmentFromURL();

    function showToast(message, type = "success") {
      const toast = document.getElementById("toast");
      const msg = document.getElementById("toastMessage");
      const icon = document.getElementById("toastIcon");

      // reset
      toast.className =
        "fixed top-6 right-6 z-[9999] max-w-sm rounded-2xl shadow-lg border p-4 flex items-start gap-3 transition-all";

      // type styles
      if (type === "success") {
        toast.classList.add("bg-green-50", "border-green-200", "text-green-700");
        icon.textContent = "check_circle";
      } else if (type === "error") {
        toast.classList.add("bg-red-50", "border-red-200", "text-red-700");
        icon.textContent = "error";
      } else if (type === "warning") {
        toast.classList.add("bg-yellow-50", "border-yellow-200", "text-yellow-700");
        icon.textContent = "warning";
      }

      msg.textContent = message;

      toast.classList.remove("hidden");

      // auto hide after 3s
      clearTimeout(window.toastTimer);
      window.toastTimer = setTimeout(hideToast, 3000);
    }

    function hideToast() {
      document.getElementById("toast").classList.add("hidden");
    }

  </script>



</body>

</html>